<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.travelog.model.mapper.TravelDetailMapper">

    <resultMap id="TravelDetailResultMap" type="travelDetailDto">
        <id property="id" column="id"/>
        <result property="travelRecordId" column="travelRecordId"/>
        <result property="touristSpotId" column="touristSpotId"/>
        <result property="sequenceOrder" column="sequenceOrder"/>
        <result property="locationName" column="locationName"/>
        <result property="description" column="description"/>
        <result property="review" column="review"/>
        <result property="cost" column="cost"/>
        <result property="visitDate" column="visitDate"/>
        <result property="imageUrls" column="imageUrls" typeHandler="com.ssafy.travelog.config.JsonListTypeHandler"/>
        <result property="photos" column="photos"/>
        <result property="latitude" column="latitude"/>
        <result property="longitude" column="longitude"/>
    </resultMap>

    <insert id="insertDetail" parameterType="travelDetailDto">
        INSERT INTO Travel_Details
        (travel_record_id, tourist_spot_id, sequence_order, location_name, description, review, cost, visit_date, image_urls, photos, latitude, longitude)
        VALUES (
                   #{travelRecordId},
                   #{touristSpotId},
                   #{sequenceOrder},
                   #{locationName},
                   #{description},
                   #{review},
                   #{cost},
                   #{visitDate},
                   #{imageUrls, typeHandler=com.ssafy.travelog.config.JsonListTypeHandler},
                   #{photos},
                   #{latitude},
                   #{longitude}
               )
    </insert>

    <select id="selectDetailsByRecordId" resultMap="TravelDetailResultMap">
        SELECT
            id,
            travel_record_id AS travelRecordId,
            tourist_spot_id AS touristSpotId,
            sequence_order AS sequenceOrder,
            location_name AS locationName,
            description,
            review,
            cost,
            visit_date AS visitDate,
            image_urls AS imageUrls,
            photos,
            latitude,
            longitude
        FROM Travel_Details
        WHERE travel_record_id = #{recordId}
        ORDER BY sequence_order ASC
    </select>

    <delete id="deleteDetail" parameterType="int">
        DELETE FROM Travel_Details
        WHERE id = #{id}
    </delete>

</mapper>